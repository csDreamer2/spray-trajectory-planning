# 喷涂轨迹规划系统 - 开发环境部署指南

## 📋 概述

本文档为新开发团队成员提供完整的开发环境搭建指南，包括所有必需的工具、库和配置步骤。

## 🎯 系统要求

### 硬件要求
- **CPU**: Intel i5 8代或AMD Ryzen 5 3600以上
- **内存**: 16GB RAM（推荐32GB）
- **存储**: 至少100GB可用空间（SSD推荐）
- **显卡**: 支持OpenGL 3.3+的独立显卡（推荐）

### 软件要求
- **操作系统**: Windows 10/11 (64位)
- **Visual Studio**: 2019或2022 Community/Professional
- **Git**: 最新版本
- **CMake**: 3.16或更高版本

## 🛠️ 开发工具安装

### 1. Visual Studio 2022（最佳）

**下载地址**: https://visualstudio.microsoft.com/

**必需组件**:
- C++ CMake tools for Visual Studio
- MSVC v143 - VS 2022 C++ x64/x86 build tools
- Windows 10/11 SDK (最新版本)
- Git for Windows

**安装步骤**:
1. 运行Visual Studio Installer
2. 选择"使用C++的桌面开发"工作负载
3. 在"单个组件"中确保勾选上述必需组件
4. 点击"安装"

### 2. Git

**下载地址**: https://git-scm.com/download/win

**配置**:
```bash
git config --global user.name "你的姓名"
git config --global user.email "你的邮箱"
```

### 3. CMake（也可以在安装qt时统一安装）

**下载地址**: https://cmake.org/download/

**安装要点**:
- 选择"Add CMake to system PATH"
- 验证安装: 打开命令行输入 `cmake --version`

## 📦 第三方库编译安装

### 🎯 工具目录结构

建议在系统中创建统一的工具目录，例如：
```
K:/Tools/                    # 主工具目录（可以是任意盘符）
├── vtkQT/                   # VTK源码和编译输出
│   ├── source/              # VTK源码
│   └── build/               # VTK编译输出
├── OpenCasCade/             # OpenCASCADE
│   ├── source/              # OpenCASCADE源码
│   └── install/             # OpenCASCADE安装输出
└── Qt/                      # Qt安装目录（可选）
```

### 1. Qt 6.10 安装

**方式一：在线安装器（推荐）**

1. 下载Qt在线安装器: https://www.qt.io/download-qt-installer
2. 运行安装器，注册Qt账号
3. 选择安装组件：
   - Qt 6.10.x
   - MSVC 2022 64-bit
   - Qt Creator（可选）
   - CMake（如果未安装）

**方式二：离线安装**
- 下载Qt 6.10.x离线安装包
- 按照安装向导完成安装

**环境变量配置**:
```
Qt6_DIR = C:/Qt/6.10.1/msvc2022_64/lib/cmake/Qt6
PATH += C:/Qt/6.10.1/msvc2022_64/bin
```

### 2. VTK 9.2 编译（可以用cmake-gui编译）

**源码获取**:
```bash
git clone https://github.com/Kitware/VTK.git
cd VTK
git checkout v9.2.0
```

**CMake配置**:
```bash
mkdir build
cd build
cmake .. -G "Visual Studio 17 2022" -A x64 \
    -DCMAKE_BUILD_TYPE=Release \
    -DVTK_GROUP_ENABLE_Qt=YES \
    -DVTK_MODULE_ENABLE_VTK_GUISupportQt=YES \
    -DVTK_MODULE_ENABLE_VTK_ViewsQt=YES \
    -DVTK_MODULE_ENABLE_VTK_RenderingQt=YES \
    -DQt6_DIR="C:/Qt/6.10.0/msvc2022_64/lib/cmake/Qt6" \
    -DCMAKE_INSTALL_PREFIX="../install"
```

**编译**:
```bash
cmake --build . --config Release --parallel 8
cmake --install . --config Release
```

**预计编译时间**: 30分钟-2小时（取决于硬件配置）

### 3. OpenCASCADE 7.6 编译（可以用cmake-gui编译）

**源码获取**:
```bash
git clone https://github.com/Open-Cascade-SAS/OCCT.git
cd OCCT
git checkout V7_6_0
```

**CMake配置**:
```bash
mkdir build
cd build
cmake .. -G "Visual Studio 17 2022" -A x64 \
    -DCMAKE_BUILD_TYPE=Release \
    -DUSE_VTK=OFF \
    -DUSE_FREEIMAGE=OFF \
    -DUSE_FFMPEG=OFF \
    -DCMAKE_INSTALL_PREFIX="../install"
```

**编译**:
```bash
cmake --build . --config Release --parallel 8
cmake --install . --config Release
```

**预计编译时间**: 1-2小时

### 4. PCL 1.13 安装

**方式一：预编译包（推荐）**
1. 下载PCL 1.13.0 All-in-one installer: https://github.com/PointCloudLibrary/pcl/releases
2. 安装到 `F:/PCL 1.13.0`（或其他目录）
3. 设置环境变量：
   ```
   PCL_ROOT = F:/PCL 1.13.0
   PATH += F:/PCL 1.13.0/bin
   ```

**方式二：源码编译**
- 如果需要自定义配置，可以从源码编译
- 编译时间较长（3-5小时）

## 🔧 项目配置

### 1. 克隆项目

```bash
git clone <项目仓库地址>
cd qtSpraySystem
```

### 2. 配置路径

编辑 `config/paths.cmake` 文件，修改以下路径为你的实际安装路径：

```cmake
# 修改这个基础路径为你的工具安装目录
set(TOOLS_BASE_DIR "K:/Tools" CACHE PATH "工具基础安装目录")
```

**重要**: 确保以下路径存在且正确：
- `${TOOLS_BASE_DIR}/vtkQT/build` - VTK编译输出
- `${TOOLS_BASE_DIR}/OpenCasCade/install` - OpenCASCADE安装目录

### 3. 验证配置

运行配置验证脚本：
```bash
cmake -S . -B build_test
```

如果看到以下输出，说明配置正确：
```
✅ VTK配置:
   构建目录: K:/Tools/vtkQT/build
   CMake目录: K:/Tools/vtkQT/build/lib/cmake/vtk-9.2
✅ OpenCASCADE配置:
   安装目录: K:/Tools/OpenCasCade/install
   头文件目录: K:/Tools/OpenCasCade/install/inc
   库目录: K:/Tools/OpenCasCade/install/win64/vc14/libd
   CMake目录: K:/Tools/OpenCasCade/install/cmake
```

## 🏗️ 项目编译

### 1. 生成项目文件

```bash
mkdir build
cd build
cmake .. -G "Visual Studio 17 2022" -A x64 -DQt6_DIR="K:/Kapps/Qt/6.10.1/msvc2022_64/lib/cmake/Qt6"
```

**注意**: 请根据你的实际Qt安装路径修改 `Qt6_DIR` 参数。常见路径格式：
- `C:/Qt/6.10.1/msvc2022_64/lib/cmake/Qt6`
- `K:/Kapps/Qt/6.10.1/msvc2022_64/lib/cmake/Qt6`

### 2. 编译项目

**命令行编译**:
```bash
cmake --build . --config Debug --parallel 8
```

**Visual Studio编译**:
1. 打开 `build/SprayTrajectoryPlanning.sln`
2. 设置启动项目为 `SprayTrajectoryPlanning`
3. 选择Debug或Release配置
4. 按F5编译并运行

### 3. 验证编译

成功编译后，应该在 `build/bin/Debug/` 目录下看到：
- `SprayTrajectoryPlanning.exe` - 主程序
- 相关的DLL文件

## 🧪 测试运行

### 1. 基础功能测试

运行主程序：
```bash
cd build/bin/Debug
./SprayTrajectoryPlanning.exe
```

### 2. STEP文件加载测试

1. 启动程序
2. 点击"导入STEP模型"
3. 选择测试文件 `data/model/MPX3500.STEP`
4. 验证异步加载功能正常

### 3. 功能验证清单

- [ ] 程序正常启动，显示主界面
- [ ] VTK 3D视图正常显示
- [ ] 系统日志面板正常工作
- [ ] STEP文件异步加载功能正常
- [ ] 进度条和状态更新正常
- [ ] 3D模型渲染正常

## 🔧 常见问题解决

### 1. CMake配置失败

**问题**: `VTK not found` 或 `OpenCASCADE not found`

**解决方案**:
1. 检查 `config/paths.cmake` 中的路径是否正确
2. 确保VTK和OpenCASCADE已正确编译和安装
3. 检查路径中是否包含中文字符或空格

### 2. 编译错误

**问题**: 找不到头文件或库文件

**解决方案**:
1. 确认所有第三方库都已正确安装
2. 检查Visual Studio版本兼容性
3. 清理build目录重新生成：
   ```bash
   rm -rf build
   mkdir build
   cd build
   cmake .. -G "Visual Studio 17 2022" -A x64
   ```

### 3. 运行时错误

**问题**: 程序启动时缺少DLL

**解决方案**:
1. 确保Qt、VTK、OpenCASCADE的bin目录在PATH中
2. 或者将必需的DLL复制到程序目录
3. 使用Dependency Walker检查缺失的依赖

### 4. STEP文件加载卡住

**问题**: 加载大型STEP文件时程序无响应

**解决方案**:
1. 这是正常现象，大型文件需要几分钟处理时间
2. 观察系统日志中的进度信息
3. 如果超过10分钟无响应，检查文件是否损坏

## 📚 开发资源

### 文档资源
- [VTK官方文档](https://vtk.org/documentation/)
- [OpenCASCADE文档](https://dev.opencascade.org/doc)
- [Qt 6文档](https://doc.qt.io/qt-6/)
- [PCL文档](https://pointclouds.org/documentation/)

### 项目文档
- `docs/` - 项目技术文档
- `README.md` - 项目概述
- `requirements.md` - 需求文档
- `design.md` - 设计文档

### 调试工具
- Visual Studio调试器
- Qt Creator（可选）
- Dependency Walker - DLL依赖检查
- Process Monitor - 文件/注册表监控

## 🚀 开发流程

### 1. 代码规范
- 使用C++17标准
- 遵循Qt编码规范
- 添加适当的注释和文档

### 2. 版本控制
- 使用Git进行版本控制
- 提交前确保代码编译通过
- 编写清晰的提交信息

### 3. 测试流程
- 每次修改后运行基础功能测试
- 大型STEP文件加载测试
- 性能回归测试

## 📞 技术支持

如果在环境搭建过程中遇到问题，请：

1. 首先查阅本文档的"常见问题解决"部分
2. 检查项目的issue列表
3. 联系项目负责人或技术团队

---

**文档版本**: v1.0  
**最后更新**: 2024-12-20  
**作者**: 王睿 (浙江大学)  
**维护者**: 开发团队