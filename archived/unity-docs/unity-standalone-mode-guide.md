# Unity独立窗口模式使用指南

## 🎯 新的工作方式

Unity现在在独立窗口中运行，不再嵌入到Qt界面中。这样更简单、更稳定！

## 🚀 使用步骤

### 1. 启动Qt程序
```bash
cd build/bin/Debug
./SprayTrajectoryPlanning.exe
```

### 2. 启动Unity应用程序
- 点击 **"启动Unity应用程序"** 按钮
- Unity独立应用程序会在新窗口中启动
- Qt程序会显示"Unity应用程序已启动"

### 3. 等待连接建立
- Unity启动后会自动连接到Qt程序
- 连接成功后状态会显示"Unity已连接 ✓"
- Qt界面会显示连接成功的信息

### 4. 操作Unity窗口
- 点击 **"打开Unity窗口"** 按钮将Unity窗口置于前台
- Unity窗口可以自由移动、调整大小
- 在Unity窗口中可以正常进行3D交互

### 5. 加载点云数据
- 在Qt程序中点击"导入点云"
- 选择点云文件（如 `test_data/sample_cube.ply`）
- 点云数据会通过TCP传输到Unity窗口显示

## 🎮 Unity窗口操作

在Unity独立窗口中：
- **鼠标左键拖拽**：旋转视角
- **滚轮**：缩放视图
- **Shift+左键**：平移视图
- **R键**：重置视角
- **F键**：聚焦到点云
- **G键**：全景视角

## ✅ 优势

### 相比窗口嵌入的好处：
1. **更稳定** - 没有复杂的窗口嵌入问题
2. **更灵活** - Unity窗口可以自由移动和调整
3. **更好的交互** - 完整的Unity交互功能
4. **更简单** - 不需要复杂的事件转发
5. **更好的性能** - Unity在独立进程中运行

### 工作流程：
1. **Qt程序** - 负责UI控制、文件管理、参数设置
2. **Unity窗口** - 负责3D可视化、点云渲染、场景交互
3. **TCP通信** - 两者之间实时数据传输

## 📋 状态指示

### Qt程序中的状态：
- **"等待Unity连接..."** - Unity未启动或未连接
- **"Unity已连接 ✓"** - 连接成功，可以传输数据
- **"Unity应用已启动"** - Unity进程运行中

### Unity窗口中的状态：
- 左上角显示："Qt连接状态: 已连接"
- 有"发送心跳"和"测试工件加载"按钮

## 🔧 故障排除

### 问题1：Unity窗口没有启动
**解决方法**：
- 确认Unity应用程序已正确构建在 `build/bin/Debug/Unity/SpraySimulation.exe`
- 检查控制台错误信息
- 尝试手动运行Unity应用程序

### 问题2：连接失败
**解决方法**：
- 确认端口12346没有被占用
- 重启Qt程序和Unity应用程序
- 检查防火墙设置

### 问题3：找不到Unity窗口
**解决方法**：
- 检查任务栏是否有Unity应用程序
- 使用Alt+Tab切换窗口
- 点击"打开Unity窗口"按钮

## 🎯 最佳实践

1. **先启动Qt程序，再启动Unity**
2. **保持两个窗口都可见，方便操作**
3. **使用"打开Unity窗口"按钮快速切换到Unity**
4. **在Unity窗口中进行3D操作，在Qt程序中进行文件和参数管理**

---

**这个独立窗口模式更加实用和稳定！** 你可以同时使用Qt程序的强大功能和Unity的3D可视化能力，而不用担心窗口嵌入的复杂问题。